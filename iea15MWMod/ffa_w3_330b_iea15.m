function airfoil = ffa_w3_330b_iea15
%ffa_w3_330b_iea15  Gets airfoil structure of FFA-W3-330b according to [1]
%
%   A = ffa_w3_330b_iea15 gets the structure of the FFA-W3-330b airfoil 
%   using data presented at reference [1].
%
%   The Reynolds number of the aerodynamic coefficients is 1e7. 
%
%   The aerodynamic data of the airfoil FFA-W3-330b has been obtained from 
%   the IEA 10MW reference wind turbine as defined by [1]
%
%   The geometry of the airfoil FFA-W3-330b has been obtained from the IEA
%   10MW reference wind turbine as defined by [1]
% 
%   Example of usage
%   p = ffa_w3_330b_iea15;
%   plotAirfoil(p,{'FFA-W3-330b'});
%   plotAirfoil(p,{'FFA-W3-330b'},'alphaSpan',linspace(-6,12,360)*pi/180);
%
%   See also airfoil2d, plotAirfoil, getKmaxAirfoil2d, isAirfoil
%
%   TODO LIST
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
%
%
[cl,cd,cm,...
 cl_data,cd_data,cm_data] = getffa_w3_330b_iea15AeroData;
% a = ffa_w3_330b_iea15;
% [AoAopt,clOpt,cdOpt,kMax]  = getKmaxAirfoil2d(a.cl,a.cd,5*pi/180);
% format long 
% AoAopt,clOpt,kMax
% plotAirfoil(a,{'FFA-W3-301'},'alphaSpan',linspace(-10,40,360)*pi/180);
% figure(1)
% plot(180/pi*AoAopt,clOpt,'r o');
% figure(2)
% plot(180/pi*AoAopt,cdOpt,'r o');
% figure(3)
% plot(180/pi*AoAopt,kMax,'r o');

% Get airfoil geometry function handles
[us,ls]       = getFFAW3_330bgeom;
 
% Get optimum values for aerodynamic maximum efficiency 
alphaOp = 0.157079632679490;
clOp    = 1.600969997856384;
kmax    = 93.211881941832189;
cdOp    = clOp/kmax;

% Get AoA interval for linear lift coefficient. This parameter was obtained
% by visual inspection of the figure resulting from the following code 
% snippet 
% 
% d2r            = pi/180;
% alphaspan      = linspace(-60,60,101)'.*d2r;
% airfoil        = @ffa_w3_330b_iea15;
% alpha_s        = NaN;
% dsa            = getStallAirfoil(alphaspan,airfoil,alpha_s);
% plotStallAirfoil(dsa,alphaspan)

alpha_linear   = [-10 4]*pi/180;

% Define output structure
airfoil = struct(...
          'class','airfoil',...
          'familyName',"FFA",...
          'id','ffa_w3_330b_iea15',...
          'ac',[0,0],...
          'ndtmax',0.330,...
          'alpha_linear',alpha_linear,...
          'alphaOpt',alphaOp,...
          'clOpt',clOp,...
          'cdOpt',cdOp,...
          'kMax',kmax,...
          'cldata',cl_data,...
          'cddata',cd_data,...
          'cmdata',cm_data,...
          'cl',cl,...
          'cd',cd,...
          'cm',cm,...
          'us',us,...
          'ls',ls...
);


end

function [cl,cd,cm,cl_data,cd_data,cm_data] = getffa_w3_330b_iea15AeroData
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%

data = [...
-3.14	0	0.031685715219416	0
-3.101699414	0.0696015	0.032281402662885	0.091428571428571
-3.061806173	0.139203	0.034064568513418	0.182857142857143
-3.021912933	0.2088045	0.037023510930709	0.274285714285714
-2.98202	0.278406	0.041138816429806	0.365714285714286
-2.94213	0.3480075	0.046383480588836	0.403082142457427
-2.902233213	0.417609	0.057320358409154	0.408013570389309
-2.862339973	0.4872105	0.083185670984014	0.412944998321191
-2.82245	0.556812	0.112582992523393	0.417876426253074
-2.78255	0.6264135	0.145326191832338	0.425863188925198
-2.74266	0.696015	0.181207966412257	0.443015955818049
-2.70277	0.7656165	0.220001159791212	0.4601687227109
-2.662873773	0.835218	0.261460204991866	0.477321489603751
-2.622980533	0.9048195	0.305322684955921	0.494474256496603
-2.583087293	0.974421	0.351311	0.487426839337876
-2.510780795	0.894118397380491	0.439132901705253	0.4683872766529
-2.438474298	0.823824232389286	0.531152085203304	0.44996335761637
-2.3661678	0.758448705448308	0.625458858035381	0.439850627833858
-2.293861303	0.694771700400014	0.720096782313821	0.429737898051347
-2.221554805	0.630785750244549	0.813103453715126	0.425892990551654
-2.149248307	0.565323378659414	0.902551400083114	0.425346936885024
-2.07694181	0.497831782584666	0.986588246185941	0.425281366165927
-2.004635312	0.428227663973017	1.06347530651478	0.426725884710504
-1.932328815	0.35679732608458	1.13162380085097	0.428170403255081
-1.860022317	0.284123098326154	1.1896279369764	0.427450257009381
-1.78771582	0.211025479603434	1.23629417032269	0.426279138932373
-1.715409322	0.138514958097457	1.27066603018177	0.423028017673354
-1.643102824	0.067750090054835	1.29204399466846	0.416830225239822
-1.570796327	5.55111512312578E-17	1.3	0.410632432806289
-1.498489829	-0.067750090054834	1.29204399466846	0.397519811544594
-1.426183332	-0.138514958097457	1.27066603018177	0.3844071902829
-1.353876834	-0.211025479603433	1.23629417032269	0.369054581823676
-1.281570336	-0.284123098326153	1.1896279369764	0.352120805930902
-1.209263839	-0.35679732608458	1.13162380085097	0.334905070092264
-1.136957341	-0.428227663973017	1.06347530651478	0.316335926513477
-1.064650844	-0.497831782584666	0.986588246185941	0.29776678293469
-0.992344346	-0.565323378659413	0.902551400083115	0.279465642108111
-0.920037849	-0.630785750244549	0.813103453715126	0.261249774884507
-0.847731351	-0.694771700400014	0.720096782313822	0.243223533218107
-0.775424853	-0.758448705448308	0.625458858035381	0.225557580110394
-0.703118356	-0.823824232389286	0.531152085203304	0.207891627002682
-0.630811858	-0.894118397380491	0.439132901705252	0.13730556744397
-0.558505361	-0.974421	0.351311	0.0627995
-0.488692191	-1.163075	0.206482	0.0390491
-0.41887902	-1.14892	0.150009	0.0185304
-0.34906585	-1.094505	0.1059962	0.00440755
-0.314159265	-1.058015	0.0873187	-0.00060625
-0.27925268	-1.022809	0.0705096	-0.0034157
-0.244346095	-0.9981	0.0547408	-0.00401445
-0.20943951	-0.985152	0.040516	-0.0027205
-0.174532925	-0.895832	0.0292903	-0.0119793
-0.13962634	-0.675386	0.0220672	-0.0345781
-0.104719755	-0.432471	0.0173521	-0.0546558
-0.06981317	-0.15881	0.0147274	-0.0742549
-0.034906585	0.1345552	0.0136237	-0.0926969
-0.017453293	0.280145	0.0133913	-0.1007386
0	0.423864	0.0132988	-0.1080164
0.017453293	0.565193	0.0133253	-0.114496
0.034906585	0.704102	0.0134498	-0.12028
0.052359878	0.840706	0.0136649	-0.125458
0.06981317	0.975002	0.0139703	-0.130108
0.087266463	1.1068	0.0143689	-0.134252
0.104719755	1.23603	0.0148623	-0.137926
0.122173048	1.36223	0.0154718	-0.14108
0.13962634	1.48424	0.016227	-0.143626
0.157079633	1.60097	0.0171756	-0.145449
0.174532925	1.7101	0.0184081	-0.146355
0.191986218	1.80957	0.0200962	-0.146348
0.20943951	1.89473	0.0225804	-0.145444
0.226892803	1.95698	0.0267093	-0.143779
0.244346095	1.98576	0.0338017	-0.141846
0.261799388	1.9926	0.0433308	-0.140038
0.27925268	1.99617	0.0535441	-0.138226
0.314159265	1.96398	0.0770596	-0.133505
0.34906585	1.81179	0.1116943	-0.131348
0.41887902	1.56073	0.191027	-0.1466
0.488692191	1.46798	0.271993	-0.172424
0.558505361	1.39203	0.351311	-0.194168
0.630811858	1.27731199625784	0.439132901705252	-0.217919463955067
0.703118356	1.17689176055612	0.531152085203305	-0.241149734677924
0.775424853	1.08349815064044	0.625458858035381	-0.257343896765959
0.847731351	0.992531000571448	0.720096782313822	-0.273538058853993
0.920037849	0.901122500349356	0.813103453715126	-0.288616471585707
0.992344346	0.807604826656305	0.902551400083115	-0.303107647814094
1.064650844	0.711188260835237	0.986588246185941	-0.317569651904883
1.136957341	0.611753805675739	1.06347530651478	-0.331939972134647
1.209263839	0.509710465835114	1.13162380085097	-0.346310292364412
1.281570336	0.405890140465934	1.1896279369764	-0.360135336264062
1.353876834	0.301464970862048	1.23629417032269	-0.373846780928271
1.426183332	0.197878511567796	1.27066603018177	-0.386812737229976
1.498489829	0.096785842935478	1.29204399466846	-0.398722585018132
1.570796327	8.32667268468867E-17	1.3	-0.410632432806289
1.643102824	-0.067750090054834	1.29204399466846	-0.416830225239822
1.715409322	-0.138514958097457	1.27066603018177	-0.423028017673354
1.78771582	-0.211025479603433	1.23629417032269	-0.426279138932373
1.860022317	-0.284123098326153	1.1896279369764	-0.427450257009381
1.932328815	-0.35679732608458	1.13162380085097	-0.428170403255081
2.004635312	-0.428227663973017	1.06347530651478	-0.426725884710504
2.07694181	-0.497831782584666	0.986588246185941	-0.425281366165927
2.149248307	-0.565323378659413	0.902551400083115	-0.425346936885024
2.221554805	-0.630785750244549	0.813103453715126	-0.425892990551654
2.293861303	-0.694771700400014	0.720096782313821	-0.429737898051347
2.3661678	-0.758448705448308	0.625458858035381	-0.439850627833858
2.438474298	-0.823824232389286	0.531152085203304	-0.44996335761637
2.510780795	-0.894118397380491	0.439132901705253	-0.4683872766529
2.583087293	-0.974421	0.351311	-0.487426839337876
2.622980533	-0.9048195	0.305322684955921	-0.494474256496603
2.662873773	-0.835218	0.261460204991866	-0.477321489603751
2.702767013	-0.7656165	0.220001159791212	-0.4601687227109
2.742660253	-0.696015	0.181207966412257	-0.443015955818049
2.782553493	-0.6264135	0.145326191832338	-0.425863188925198
2.822446733	-0.556812	0.112582992523393	-0.435019283395931
2.862339973	-0.4872105	0.083185670984014	-0.452944998321191
2.902233213	-0.417609	0.057320358409154	-0.470870713246452
2.942126453	-0.3480075	0.046383480588836	-0.488796428171712
2.982019693	-0.278406	0.041138816429806	-0.457142857142857
3.021912933	-0.2088045	0.037023510930709	-0.342857142857143
3.061806173	-0.139203	0.034064568513418	-0.228571428571429
3.101699414	-0.0696015	0.032281402662885	-0.114285714285714
3.14	0	0.031685715219416	0
];    

alpha_i   = data(:,1);
cl_i      = data(:,2);
cd_i      = data(:,3);
cm_i      = data(:,4);
cl        = @(alpha)interp1(alpha_i,cl_i,alpha);
cd        = @(alpha)interp1(alpha_i,cd_i,alpha);
cm        = @(alpha)interp1(alpha_i,cm_i,alpha);

cl_data   = [alpha_i,cl_i];
cd_data   = [alpha_i,cd_i];
cm_data   = [alpha_i,cm_i];

end

function [us,ls] = getFFAW3_330bgeom
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
data_ls = [
0	0.00098
0.00048	-0.00761
0.00174	-0.01613
0.00344	-0.02443
0.00581	-0.03254
0.00892	-0.04061
0.01269	-0.0484
0.01696	-0.05589
0.02165	-0.0631
0.02674	-0.07004
0.03223	-0.07669
0.03808	-0.08304
0.04424	-0.0891
0.05068	-0.09487
0.05737	-0.10036
0.06428	-0.10559
0.07139	-0.11054
0.07869	-0.11522
0.08616	-0.11964
0.09378	-0.1238
0.10153	-0.12771
0.1094	-0.13138
0.11738	-0.13483
0.12545	-0.13805
0.13361	-0.14107
0.14184	-0.14388
0.15013	-0.14648
0.15849	-0.14889
0.16691	-0.15111
0.17537	-0.15313
0.18388	-0.15498
0.19242	-0.15666
0.20099	-0.15816
0.2096	-0.1595
0.21822	-0.16068
0.22687	-0.16169
0.23554	-0.16255
0.24423	-0.16325
0.25292	-0.16381
0.26162	-0.16421
0.27033	-0.16447
0.27905	-0.16458
0.28776	-0.16456
0.29648	-0.1644
0.30519	-0.1641
0.31389	-0.16368
0.32259	-0.16312
0.33128	-0.16244
0.33996	-0.16164
0.34863	-0.16071
0.35728	-0.15967
0.36592	-0.15851
0.37455	-0.15723
0.38315	-0.15585
0.39174	-0.15435
0.40031	-0.15274
0.40885	-0.15103
0.41738	-0.14921
0.42588	-0.14729
0.43435	-0.14527
0.44281	-0.14316
0.45123	-0.14094
0.45963	-0.13864
0.46801	-0.13625
0.47636	-0.13378
0.48469	-0.13123
0.493	-0.12861
0.50128	-0.12592
0.50954	-0.12316
0.51777	-0.12034
0.52599	-0.11746
0.53418	-0.11452
0.54235	-0.11153
0.5505	-0.10849
0.55863	-0.1054
0.56675	-0.10226
0.57484	-0.09909
0.58293	-0.09589
0.591	-0.09265
0.59905	-0.08939
0.6071	-0.08611
0.61517	-0.08281
0.62324	-0.0795
0.63131	-0.07618
0.63937	-0.07286
0.64743	-0.06955
0.65549	-0.06624
0.66356	-0.06295
0.67163	-0.05968
0.67971	-0.05644
0.6878	-0.05323
0.6959	-0.05005
0.70402	-0.04693
0.71216	-0.04386
0.72031	-0.04085
0.72849	-0.0379
0.73669	-0.03502
0.74491	-0.03221
0.75315	-0.02949
0.76143	-0.02685
0.76973	-0.02431
0.77805	-0.02187
0.78641	-0.01954
0.7948	-0.01733
0.80321	-0.01523
0.81165	-0.01325
0.82012	-0.01138
0.82861	-0.00965
0.83712	-0.00805
0.84566	-0.00658
0.85422	-0.00526
0.8628	-0.0041
0.87141	-0.0031
0.88003	-0.00227
0.88866	-0.00161
0.89733	-0.00114
0.90601	-0.00084
0.91468	-0.00073
0.92334	-0.00081
0.93199	-0.00107
0.94063	-0.00152
0.94925	-0.00216
0.95784	-0.00302
0.96639	-0.00415
0.97489	-0.00559
0.98332	-0.00734
0.99168	-0.00939
1	-0.01163
];  

data_us = [...
1	0.01245
0.9917	0.0146
0.98339	0.01675
0.97509	0.01888
0.96678	0.021
0.95847	0.0231
0.95016	0.0252
0.94186	0.0273
0.93356	0.0294
0.92526	0.03151
0.91697	0.03364
0.90869	0.03578
0.90042	0.03793
0.89215	0.04009
0.88388	0.04226
0.87562	0.04443
0.86736	0.0466
0.85911	0.04878
0.85086	0.05097
0.84261	0.05315
0.83437	0.05535
0.82613	0.05754
0.81789	0.05973
0.80966	0.06193
0.80143	0.06412
0.7932	0.0663
0.78497	0.06849
0.77674	0.07067
0.76852	0.07285
0.76029	0.07503
0.75207	0.0772
0.74385	0.07937
0.73562	0.08153
0.7274	0.08369
0.71918	0.08584
0.71096	0.08798
0.70273	0.09011
0.69451	0.09223
0.68629	0.09434
0.67806	0.09644
0.66983	0.09853
0.66161	0.10062
0.65338	0.10268
0.64514	0.10474
0.63691	0.10678
0.62867	0.10881
0.62044	0.11083
0.61219	0.11283
0.60395	0.11481
0.5957	0.11678
0.58745	0.11874
0.5792	0.12067
0.57094	0.12259
0.56268	0.12449
0.55441	0.12636
0.54614	0.12822
0.53787	0.13005
0.52959	0.13187
0.5213	0.13365
0.51301	0.13542
0.50471	0.13715
0.49641	0.13886
0.48813	0.14053
0.47986	0.14218
0.47159	0.14378
0.4633	0.14536
0.45501	0.14689
0.44671	0.14838
0.4384	0.14984
0.43008	0.15124
0.42176	0.1526
0.41342	0.15392
0.40507	0.15518
0.39672	0.15639
0.38835	0.15755
0.37998	0.15865
0.37159	0.15969
0.3632	0.16067
0.35479	0.16158
0.34638	0.16242
0.33796	0.16319
0.32953	0.16389
0.32109	0.16451
0.31264	0.16504
0.30418	0.16549
0.29572	0.16586
0.28725	0.16613
0.27878	0.1663
0.2703	0.16636
0.26182	0.16632
0.25334	0.16615
0.24486	0.16587
0.23638	0.16546
0.2279	0.16491
0.21943	0.16423
0.21097	0.1634
0.20253	0.1624
0.1941	0.16125
0.1857	0.15991
0.17733	0.15839
0.16898	0.15668
0.16068	0.15478
0.15243	0.15266
0.14423	0.15033
0.1361	0.14779
0.12803	0.14502
0.12004	0.14203
0.11215	0.1388
0.10436	0.13531
0.09669	0.13157
0.08915	0.12757
0.08176	0.12331
0.07453	0.11877
0.06748	0.11395
0.06064	0.10886
0.05402	0.10348
0.04763	0.09783
0.04151	0.09189
0.03567	0.08568
0.03015	0.07919
0.02498	0.07242
0.02018	0.06539
0.01577	0.0581
0.01178	0.05056
0.0083	0.04277
0.00551	0.03473
0.0034	0.02648
0.00177	0.01806
0.00052	0.00955
0	0.00098
];


ndy_ls      = 0.25 - data_ls(:,1);
ndy_us      = 0.25 - data_us(:,1);
ndz_ls      = data_ls(:,2);
ndz_us      = data_us(:,2);

ls          = @(ndy)interp1(ndy_ls,ndz_ls,ndy);
us          = @(ndy)interp1(ndy_us,ndz_us,ndy);

end

