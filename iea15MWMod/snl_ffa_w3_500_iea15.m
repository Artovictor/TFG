function airfoil = snl_ffa_w3_500_iea15
%snl_ffa_w3_500_iea15  Gets airfoil structure of SNL-FFA-W3-360 according to [1]
%
%   A = snl_ffa_w3_500_iea15 gets the structure of the SNL-FFA-W3-360 airfoil 
%   using data presented at reference [1].
%
%   The Reynolds number of the aerodynamic coefficients is 1e7. 
%
%   The aerodynamic data of the airfoil SNL-FFA-W3-360 has been obtained from 
%   the IEA 10MW reference wind turbine as defined by [1]
%
%   The geometry of the airfoil SNL-FFA-W3-360 has been obtained from the IEA
%   10MW reference wind turbine as defined by [1]
% 
%   Example of usage
%   p = snl_ffa_w3_500_iea15;
%   plotAirfoil(p,{'SNL-FFA-W3-360'});
%   plotAirfoil(p,{'SNL-FFA-W3-360'},'alphaSpan',linspace(-6,12,360)*pi/180);
%
%   See also airfoil2d, plotAirfoil, getKmaxAirfoil2d, isAirfoil
%
%   TODO LIST
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
%
%
[cl,cd,cm,...
 cl_data,cd_data,cm_data] = getsnl_ffa_w3_500_iea15AeroData;
% a = snl_ffa_w3_500_iea15;
% [AoAopt,clOpt,cdOpt,kMax]  = getKmaxAirfoil2d(a.cl,a.cd,5*pi/180);
% format long 
% AoAopt,clOpt,kMax
% plotAirfoil(a,{'FFA-W3-301'},'alphaSpan',linspace(-10,40,360)*pi/180);
% figure(1)
% plot(180/pi*AoAopt,clOpt,'r o');
% figure(2)
% plot(180/pi*AoAopt,cdOpt,'r o');
% figure(3)
% plot(180/pi*AoAopt,kMax,'r o');

% Get airfoil geometry function handles
[us,ls]       = getSNLFFAW3_500geom;
 
% Get optimum values for aerodynamic maximum efficiency 
alphaOp = 0.225324733509424;
clOp    = 1.682411485983683;
kmax    = 18.090279558371940;
cdOp    = clOp/kmax;

% Get AoA interval for linear lift coefficient. This parameter was obtained
% by visual inspection of the figure resulting from the following code 
% snippet 
% 
% d2r            = pi/180;
% alphaspan      = linspace(-60,60,101)'.*d2r;
% airfoil        = @snl_ffa_w3_500_iea15;
% alpha_s        = NaN;
% dsa            = getStallAirfoil(alphaspan,airfoil,alpha_s);
% plotStallAirfoil(dsa,alphaspan)

alpha_linear   = [-10 4]*pi/180;

% Define output structure
airfoil = struct(...
          'class','airfoil',...
          'familyName',"FFA",...
          'id','snl_ffa_w3_500_iea15',...
          'ac',[0,0],...
          'ndtmax',0.500,...
          'alpha_linear',alpha_linear,...
          'alphaOpt',alphaOp,...
          'clOpt',clOp,...
          'cdOpt',cdOp,...
          'kMax',kmax,...
          'cldata',cl_data,...
          'cddata',cd_data,...
          'cmdata',cm_data,...
          'cl',cl,...
          'cd',cd,...
          'cm',cm,...
          'us',us,...
          'ls',ls...
);


end

function [cl,cd,cm,cl_data,cd_data,cm_data] = getsnl_ffa_w3_500_iea15AeroData
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%

data = [...
-3.141	0	0.0844	0
-2.96706	0.4419	0.0844	0.3125
-2.79253	0.8837	0.1268	0.2831
-2.61799	0.9674	0.2927	0.2632
-2.44346	0.7801	0.497	0.2048
-2.26893	0.6293	0.7161	0.1932
-2.0944	0.4785	0.9246	0.2008
-1.91986	0.3189	1.0985	0.2136
-1.74533	0.1553	1.2182	0.2221
-1.5708	0	1.2707	0.2198
-1.39626	-0.1553	1.2182	0.196
-1.22173	-0.3189	1.0985	0.1635
-1.0472	-0.4784	0.9246	0.1285
-0.87266	-0.6293	0.7161	0.0965
-0.69813	-0.7801	0.497	0.0716
-0.5236	-0.9674	0.2927	0.0522
-0.34907	-1.0281	0.1499	-0.0063
-0.3447	-1.0243	0.1472	-0.0089
-0.33598	-1.0052	0.1447	-0.0099
-0.33161	-0.9971	0.1433	-0.0105
-0.32725	-1.0052	0.1403	-0.011
-0.32289	-0.9995	0.1386	-0.0116
-0.31852	-0.9908	0.1373	-0.012
-0.31416	-0.9815	0.136	-0.0126
-0.30543	-0.9764	0.1322	-0.0135
-0.30107	-0.9705	0.1306	-0.0139
-0.29671	-0.9655	0.129	-0.0143
-0.29234	-0.9662	0.1268	-0.0147
-0.28798	-0.9544	0.1258	-0.0151
-0.28362	-0.9444	0.1246	-0.0155
-0.27925	-0.9405	0.1229	-0.0158
-0.27489	-0.9433	0.1206	-0.0161
-0.27053	-0.933	0.1195	-0.0164
-0.26616	-0.9211	0.1185	-0.0168
-0.25744	-0.9158	0.115	-0.0173
-0.25307	-0.907	0.1138	-0.0175
-0.24871	-0.8959	0.1127	-0.0178
-0.24435	-0.8926	0.111	-0.0181
-0.23998	-0.8808	0.11	-0.0184
-0.23562	-0.8722	0.1089	-0.0186
-0.23126	-0.866	0.1075	-0.0188
-0.22689	-0.8626	0.1059	-0.0188
-0.22253	-0.8489	0.1051	-0.0192
-0.21817	-0.8363	0.1042	-0.0194
-0.2138	-0.8363	0.1023	-0.0194
-0.20944	-0.8271	0.1013	-0.0196
-0.20508	-0.8141	0.1004	-0.0198
-0.20071	-0.8004	0.0997	-0.02
-0.19199	-0.789	0.0971	-0.0199
-0.18762	-0.7862	0.0956	-0.0196
-0.18326	-0.7747	0.0948	-0.0194
-0.1789	-0.7701	0.094	-0.0184
-0.17453	-0.7674	0.0925	-0.0183
-0.17017	-0.7506	0.0917	-0.0192
-0.16581	-0.729	0.0912	-0.0205
-0.16144	-0.7095	0.0902	-0.0224
-0.15708	-0.6855	0.0895	-0.0247
-0.15272	-0.659	0.0891	-0.0267
-0.14835	-0.6319	0.0887	-0.0287
-0.14399	-0.6019	0.0879	-0.032
-0.13963	-0.5718	0.0875	-0.0345
-0.13526	-0.5424	0.0873	-0.0367
-0.1309	-0.5098	0.0868	-0.0399
-0.12654	-0.4767	0.0864	-0.043
-0.12217	-0.4454	0.0862	-0.0453
-0.11781	-0.4142	0.086	-0.0476
-0.11345	-0.3791	0.0856	-0.051
-0.10908	-0.346	0.0853	-0.0538
-0.10472	-0.3144	0.0852	-0.056
-0.10036	-0.2817	0.085	-0.0586
-0.09599	-0.2461	0.0847	-0.0619
-0.09163	-0.2133	0.0846	-0.0644
-0.08727	-0.1827	0.0845	-0.0663
-0.0829	-0.1494	0.0843	-0.0688
-0.07854	-0.1158	0.0842	-0.0715
-0.07418	-0.0837	0.084	-0.0737
-0.06981	-0.0529	0.084	-0.0756
-0.06545	-0.0225	0.0839	-0.0774
-0.06109	0.0089	0.0838	-0.0793
-0.05672	0.0392	0.0838	-0.0811
-0.05236	0.0686	0.0838	-0.0826
-0.048	0.0974	0.0838	-0.0838
-0.04363	0.126	0.0838	-0.0852
-0.03927	0.1555	0.0838	-0.0867
-0.03491	0.1853	0.0838	-0.0883
-0.03054	0.2146	0.0837	-0.0897
-0.02618	0.243	0.0837	-0.091
-0.02182	0.2713	0.0838	-0.0921
-0.01745	0.3006	0.0838	-0.0936
-0.01309	0.3295	0.0838	-0.0949
-0.00873	0.3578	0.0838	-0.0961
-0.00436	0.3857	0.0838	-0.0972
0	0.4135	0.0838	-0.0983
0.00401	0.4425	0.0839	-0.0995
0.0082	0.4715	0.0839	-0.1008
0.01222	0.5003	0.0839	-0.1019
0.01641	0.5286	0.084	-0.1029
0.02042	0.5567	0.084	-0.104
0.02443	0.585	0.0841	-0.105
0.02862	0.6135	0.0841	-0.1061
0.03264	0.6417	0.0842	-0.1072
0.03683	0.6697	0.0842	-0.1082
0.04084	0.6975	0.0843	-0.1091
0.04485	0.7251	0.0843	-0.11
0.04904	0.7528	0.0844	-0.1109
0.05306	0.7807	0.0845	-0.1119
0.05725	0.8083	0.0846	-0.1128
0.06126	0.8358	0.0846	-0.1137
0.06528	0.8631	0.0847	-0.1146
0.06946	0.8902	0.0847	-0.1153
0.07348	0.9173	0.0848	-0.1161
0.07767	0.9444	0.0849	-0.117
0.08168	0.9713	0.085	-0.1178
0.0857	0.9981	0.0851	-0.1185
0.08988	1.0249	0.0852	-0.1192
0.0939	1.0515	0.0853	-0.1199
0.09809	1.0779	0.0853	-0.1206
0.1021	1.1041	0.0854	-0.1212
0.10612	1.1302	0.0856	-0.1218
0.1103	1.156	0.0857	-0.1224
0.11432	1.1818	0.0858	-0.123
0.11851	1.2076	0.0859	-0.1235
0.12252	1.2334	0.086	-0.124
0.12654	1.2589	0.0861	-0.1245
0.13073	1.2841	0.0862	-0.125
0.13474	1.3088	0.0864	-0.1254
0.13893	1.3331	0.0865	-0.1257
0.14294	1.357	0.0867	-0.1259
0.14696	1.381	0.0869	-0.1262
0.15115	1.4054	0.087	-0.1265
0.15516	1.4295	0.0871	-0.1267
0.15917	1.4531	0.0873	-0.127
0.17244	1.5154	0.0879	-0.1265
0.1857	1.5749	0.0886	-0.1256
0.19897	1.6151	0.0895	-0.1214
0.21206	1.6443	0.0912	-0.1163
0.22532	1.6824	0.093	-0.1133
0.23859	1.7146	0.0954	-0.1107
0.25168	1.7362	0.0989	-0.108
0.26494	1.7627	0.1024	-0.1063
0.27821	1.7706	0.1076	-0.1042
0.2913	1.7639	0.1144	-0.1025
0.30456	1.7604	0.1211	-0.1013
0.31782	1.7251	0.131	-0.1001
0.33109	1.7035	0.1399	-0.0998
0.34418	1.6784	0.1492	-0.1001
0.35744	1.6505	0.1591	-0.1016
0.37071	1.6227	0.1691	-0.1036
0.3838	1.6067	0.1778	-0.1064
0.39706	1.5972	0.1858	-0.1099
0.41033	1.5892	0.1937	-0.1136
0.42342	1.5815	0.2014	-0.118
0.43668	1.5563	0.2135	-0.1249
0.44995	1.5272	0.2267	-0.1325
0.46304	1.4982	0.2399	-0.14
0.4763	1.4691	0.2531	-0.1476
0.48956	1.4401	0.2663	-0.1551
0.50283	1.411	0.2795	-0.1627
0.51592	1.382	0.2927	-0.1703
0.52918	1.3622	0.3078	-0.174
0.54245	1.3424	0.323	-0.1777
0.55554	1.3225	0.3381	-0.1815
0.5688	1.3027	0.3532	-0.1852
0.58207	1.2829	0.3684	-0.1889
0.59516	1.2631	0.3835	-0.1926
0.60842	1.2433	0.3987	-0.1964
0.62169	1.2234	0.4138	-0.2001
0.63495	1.2036	0.4289	-0.2039
0.64804	1.1838	0.4441	-0.2076
0.66131	1.164	0.4592	-0.2113
0.67457	1.1442	0.4743	-0.215
0.68766	1.1243	0.4895	-0.2188
0.70092	1.1064	0.5052	-0.2218
0.71419	1.0905	0.5214	-0.2242
0.72728	1.0745	0.5376	-0.2266
0.74054	1.0586	0.5538	-0.2289
0.75381	1.0426	0.5701	-0.2313
0.7669	1.0267	0.5863	-0.2337
0.78016	1.0107	0.6025	-0.2361
0.79343	0.9948	0.6188	-0.2384
0.80669	0.9788	0.635	-0.2408
0.81978	0.9628	0.6512	-0.2432
0.83305	0.9469	0.6675	-0.2455
0.84631	0.9309	0.6837	-0.2479
0.8594	0.915	0.6999	-0.2503
0.87266	0.899	0.7161	-0.2527
1.0472	0.6836	0.9246	-0.2833
1.22173	0.4556	1.0985	-0.3156
1.39626	0.2219	1.2182	-0.3482
1.5708	0	1.2707	-0.3773
1.74533	-0.1553	1.2182	-0.3877
1.91986	-0.3189	1.0985	-0.3865
2.0944	-0.4784	0.9246	-0.3806
2.26893	-0.6293	0.7161	-0.3803
2.44346	-0.7801	0.497	-0.4032
2.61799	-0.9674	0.2927	-0.4854
2.79253	-0.8837	0.1268	-0.5325
2.96706	-0.4418	0.0844	-0.3906
3.141	0	0.0844	0
];    

alpha_i   = data(:,1);
cl_i      = data(:,2);
cd_i      = data(:,3);
cm_i      = data(:,4);
cl        = @(alpha)interp1(alpha_i,cl_i,alpha);
cd        = @(alpha)interp1(alpha_i,cd_i,alpha);
cm        = @(alpha)interp1(alpha_i,cm_i,alpha);

cl_data   = [alpha_i,cl_i];
cd_data   = [alpha_i,cd_i];
cm_data   = [alpha_i,cm_i];

end

function [us,ls] = getSNLFFAW3_500geom
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
data_ls = [
0	0
7.807E-05	-0.00676349
0.00029009	-0.0092701
0.00059937	-0.01485268
0.00096448	-0.01909805
0.00146264	-0.02425157
0.00219661	-0.03028001
0.00309879	-0.03749177
0.00409516	-0.04339708
0.00526774	-0.049743
0.00665839	-0.05593635
0.00821941	-0.06191302
0.00993095	-0.06758273
0.01187982	-0.07340171
0.01404463	-0.07913246
0.01639219	-0.08498169
0.01898469	-0.09099183
0.02182867	-0.09692059
0.02489252	-0.10302984
0.02822001	-0.10915375
0.03182924	-0.11531066
0.03568998	-0.12113778
0.03984236	-0.12714727
0.04430035	-0.13319857
0.04903788	-0.13898026
0.05410025	-0.1448503
0.05948747	-0.15067474
0.06518787	-0.15648787
0.07124791	-0.16231789
0.07764648	-0.16795081
0.08439704	-0.17355519
0.0915234	-0.17904803
0.09900711	-0.18436086
0.10688721	-0.18964752
0.11514762	-0.19466991
0.12380644	-0.19967718
0.13287211	-0.20448577
0.14233176	-0.20911273
0.1522146	-0.21356541
0.16249918	-0.21790461
0.17321393	-0.22189862
0.18434125	-0.22585022
0.19590296	-0.22942761
0.20788328	-0.23282521
0.22029378	-0.23594152
0.23312344	-0.23867787
0.24637487	-0.24127615
0.26004146	-0.24342871
0.27412439	-0.24536479
0.28861129	-0.24668824
0.30349962	-0.24775175
0.3187741	-0.2484068
0.33443448	-0.2487
0.35045732	-0.24831476
0.36684322	-0.2476416
0.38356093	-0.24639477
0.40060975	-0.24454631
0.41795607	-0.24221768
0.4355933	-0.23936461
0.4534925	-0.23593587
0.47163211	-0.23173768
0.48999236	-0.22714767
0.50853595	-0.22177388
0.52724867	-0.21593576
0.5460886	-0.20951266
0.5650309	-0.20242622
0.58404504	-0.19484392
0.603088	-0.18680862
0.62213765	-0.1783067
0.64114752	-0.16936964
0.66008031	-0.16006127
0.67890619	-0.15031319
0.69757164	-0.14049402
0.71604492	-0.13044955
0.73429135	-0.12028637
0.75225234	-0.11020462
0.76989792	-0.10038818
0.78719153	-0.0907307
0.80407383	-0.08140578
0.82051349	-0.07271636
0.83646946	-0.06444497
0.85189026	-0.05666457
0.86674791	-0.04953952
0.8810097	-0.04299056
0.89461041	-0.03713052
0.90752456	-0.0319789
0.9197304	-0.02747518
0.9311753	-0.02370172
0.94182765	-0.02037524
0.95167536	-0.01799359
0.96067486	-0.01593023
0.96878747	-0.01421422
0.97601191	-0.01283805
0.98233053	-0.01177726
0.98768615	-0.01099873
0.99208631	-0.01045135
0.99557391	-0.01008163
0.99806302	-0.00985456
0.99942968	-0.00974345
1	0
];  

data_us = [...
1	0
0.99944304	0.01086983
0.99812049	0.0117452
0.99569352	0.01334146
0.99230484	0.01554892
0.98802844	0.01830045
0.98281508	0.02160574
0.97666422	0.02544031
0.96964069	0.02973944
0.96174313	0.03448209
0.95297315	0.03964881
0.94338928	0.045193
0.93301284	0.05091599
0.92185147	0.05708281
0.90995468	0.06358138
0.89736121	0.07042743
0.88408503	0.07734661
0.8701629	0.08467081
0.85565276	0.0921802
0.84057695	0.09990118
0.82497463	0.10756554
0.80889455	0.11533963
0.79236237	0.12314445
0.77542101	0.13105863
0.75812546	0.13880784
0.7405018	0.14656091
0.72259209	0.15414446
0.70444539	0.16162243
0.68608843	0.1690763
0.66757021	0.17621938
0.64892678	0.18309227
0.63018643	0.18987002
0.61140138	0.19625049
0.59259673	0.20235037
0.57380843	0.20831587
0.5550757	0.21376127
0.53641763	0.21902667
0.51787958	0.22392548
0.49948103	0.22835814
0.48125155	0.23243074
0.46322225	0.23602942
0.44540666	0.23922962
0.42784323	0.24206676
0.41053864	0.24439517
0.39352525	0.24632908
0.37681123	0.24781218
0.36041977	0.24907553
0.34436494	0.24961759
0.32865846	0.25
0.31331898	0.2499146
0.29834798	0.24940354
0.2837658	0.2484402
0.26956679	0.24723387
0.25577362	0.2455593
0.2423778	0.24358422
0.22939648	0.24124765
0.21681735	0.2386039
0.20465763	0.23566026
0.19290757	0.2324321
0.18157496	0.22883962
0.17065819	0.22496679
0.16014896	0.22083239
0.15005511	0.21649585
0.14035465	0.21197874
0.1310675	0.20722821
0.12216148	0.20232328
0.11365876	0.197174
0.10553619	0.19203678
0.09779065	0.18655863
0.09042902	0.18109338
0.08341621	0.17545947
0.07677403	0.16968205
0.0704692	0.16378555
0.06450016	0.1577649
0.05888182	0.15169879
0.05356799	0.14556478
0.04857581	0.13948626
0.04389793	0.1333378
0.03949498	0.1270497
0.03539484	0.12086576
0.03157626	0.11468985
0.02800644	0.10849184
0.02471592	0.1022246
0.02168071	0.09589286
0.01886319	0.08980724
0.01629514	0.08374779
0.0139662	0.07773838
0.01181764	0.07187918
0.00988361	0.0660103
0.00818368	0.06018911
0.00663128	0.0539095
0.00524853	0.04732699
0.00408271	0.04014879
0.00308998	0.03372622
0.00219098	0.02591034
0.00145967	0.0200319
0.00096333	0.01481159
0.00059878	0.01096429
0.00028988	0.00515421
7.804E-05	0.00237777
0           0
];


ndy_ls      = 0.25 - data_ls(:,1);
ndy_us      = 0.25 - data_us(:,1);
ndz_ls      = data_ls(:,2);
ndz_us      = data_us(:,2);

ls          = @(ndy)interp1(ndy_ls,ndz_ls,ndy);
us          = @(ndy)interp1(ndy_us,ndz_us,ndy);

end

