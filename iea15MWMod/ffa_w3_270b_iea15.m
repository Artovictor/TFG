function airfoil = ffa_w3_270b_iea15
%ffa_w3_270b_iea15  Gets airfoil structure of FFA-W3-270b according to [1]
%
%   A = ffa_w3_270b_iea15 gets the structure of the FFA-W3-270b airfoil 
%   using data presented at reference [1].
%
%   The Reynolds number of the aerodynamic coefficients is 1e7. 
%
%   The aerodynamic data of the airfoil FFA-W3-270b has been obtained from 
%   the IEA 10MW reference wind turbine as defined by [1]
%
%   The geometry of the airfoil FFA-W3-270b has been obtained from the IEA
%   10MW reference wind turbine as defined by [1]
% 
%   Example of usage
%   p = ffa_w3_270b_iea15;
%   plotAirfoil(p,{'FFA-W3-270b'});
%   plotAirfoil(p,{'FFA-W3-270b'},'alphaSpan',linspace(-6,12,360)*pi/180);
%
%   See also airfoil2d, plotAirfoil, getKmaxAirfoil2d, isAirfoil
%
%   TODO LIST
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
%
%
[cl,cd,cm,...
 cl_data,cd_data,cm_data] = getffa_w3_270b_iea15AeroData;
% a = ffa_w3_270b_iea15;
% [AoAopt,clOpt,cdOpt,kMax]  = getKmaxAirfoil2d(a.cl,a.cd,5*pi/180);
% format long 
% AoAopt,clOpt,kMax
% plotAirfoil(a,{'FFA-W3-270b'},'alphaSpan',linspace(-10,40,360)*pi/180);
% figure(1)
% plot(180/pi*AoAopt,clOpt,'r o');
% figure(2)
% plot(180/pi*AoAopt,cdOpt,'r o');
% figure(3)
% plot(180/pi*AoAopt,kMax,'r o');

% Get airfoil geometry function handles
[us,ls]       = getFFAW3_270bgeom;
 
% Get optimum values for aerodynamic maximum efficiency 
alphaOp = 0.157079632679490;
clOp    = 1.488409997895132;
kmax    = 1.100081300542721e+02;
cdOp    = clOp/kmax;

% Get AoA interval for linear lift coefficient. This parameter was obtained
% by visual inspection of the figure resulting from the following code 
% snippet 
% 
% d2r            = pi/180;
% alphaspan      = linspace(-60,60,101)'.*d2r;
% airfoil        = @ffa_w3_270b_iea15;
% alpha_s        = NaN;
% dsa            = getStallAirfoil(alphaspan,airfoil,alpha_s);
% plotStallAirfoil(dsa,alphaspan)

alpha_linear   = [-10 4]*pi/180;

% Define output structure
airfoil = struct(...
          'class','airfoil',...
          'familyName',"FFA",...
          'id','ffa_w3_270b_iea15',...
          'ac',[0,0],...
          'ndtmax',0.270,...
          'alpha_linear',alpha_linear,...
          'alphaOpt',alphaOp,...
          'clOpt',clOp,...
          'cdOpt',cdOp,...
          'kMax',kmax,...
          'cldata',cl_data,...
          'cddata',cd_data,...
          'cmdata',cm_data,...
          'cl',cl,...
          'cd',cd,...
          'cm',cm,...
          'us',us,...
          'ls',ls...
);


end

function [cl,cd,cm,cl_data,cd_data,cm_data] = getffa_w3_270b_iea15AeroData
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%

data = [...
-3.14	0	0.015451456175253	0
-3.101699414	0.062129	0.016107778493333	0.091428571428571
-3.061806173	0.124258	0.018072525946644	0.182857142857143
-3.021912933	0.186387	0.021333025784437	0.274285714285714
-2.98202	0.248516	0.025868253508747	0.365714285714286
-2.94213	0.310645	0.032888365937279	0.398737801088277
-2.902233213	0.372773999999999	0.056807233237926	0.39671828282952
-2.862339973	0.434903	0.084714010604476	0.394698764570763
-2.82245	0.497032	0.116432240254971	0.392679246312006
-2.78255	0.559161	0.151761378409852	0.39543943591957
-2.74266	0.62129	0.190478069242184	0.412538749126096
-2.70277	0.683419	0.232337563711276	0.429638062332622
-2.662873773	0.745548	0.277075274255984	0.446737375539148
-2.622980533	0.807677	0.324408455459959	0.463836688745674
-2.583087293	0.869806	0.374038	0.461864969361447
-2.510780795	0.816599487720736	0.468820635304915	0.453353192753145
-2.438474298	0.768119598370022	0.568144803367643	0.445231259198508
-2.3661678	0.720399052968062	0.669952728182786	0.442372206868359
-2.293861303	0.670952463384278	0.772136186954782	0.43951315453821
-2.221554805	0.61827824285918	0.872580432676418	0.440719923953067
-2.149248307	0.561575146657653	0.969208246034643	0.444066599549505
-2.07694181	0.50056939366648	1.06002319749904	0.447387756931984
-2.004635312	0.435401383049361	1.14315121697016	0.450628714213448
-1.932328815	0.366545579490456	1.2168796037278	0.453869671494912
-1.860022317	0.294749276481367	1.27969266288401	0.453772151219927
-1.78771582	0.220982292815904	1.33030322499733	0.452979114787347
-1.715409322	0.146393147121067	1.3676793914705	0.449733969780528
-1.643102824	0.072269266496991	1.39106594804109	0.443015004293534
-1.570796327	5.55111512312578E-17	1.4	0.436296038806539
-1.498489829	-0.072269266496991	1.39106594804109	0.421799002920476
-1.426183332	-0.146393147121067	1.3676793914705	0.407301967034412
-1.353876834	-0.220982292815904	1.33030322499733	0.390195220216865
-1.281570336	-0.294749276481367	1.27969266288401	0.371246324506505
-1.209263839	-0.366545579490456	1.2168796037278	0.351904292150308
-1.136957341	-0.435401383049361	1.14315121697016	0.330675203894094
-1.064650844	-0.50056939366648	1.06002319749904	0.309446115637879
-0.992344346	-0.561575146657653	0.969208246034644	0.288154029724106
-0.920037849	-0.61827824285918	0.872580432676418	0.266841899101109
-0.847731351	-0.670952463384278	0.772136186954782	0.245760070657996
-0.775424853	-0.720399052968062	0.669952728182786	0.22511581635666
-0.703118356	-0.768119598370022	0.568144803367644	0.204471562055324
-0.630811858	-0.816599487720737	0.468820635304915	0.139565892696459
-0.558505361	-0.869806	0.374038	0.0713816
-0.488692191	-1.098365	0.218804	0.0439981
-0.41887902	-1.083388	0.159821	0.0216604
-0.34906585	-1.069897	0.107443	0.0042194
-0.314159265	-1.05454	0.0869038	-0.00035185
-0.27925268	-1.034316	0.0684434	-0.00333715
-0.244346095	-1.0836	0.0473338	-0.0028317
-0.20943951	-1.094892	0.0308488	-0.0055562
-0.174532925	-0.926646	0.0198433	-0.02951695
-0.13962634	-0.696755	0.0143943	-0.0482178
-0.104719755	-0.436276	0.01154858	-0.0648322
-0.06981317	-0.162516	0.0102638	-0.0791866
-0.034906585	0.1070901	0.00975514	-0.0904066
-0.017453293	0.239931	0.00967083	-0.0951728
0	0.371578	0.00967746	-0.0995328
0.017453293	0.502096	0.00976408	-0.103549
0.034906585	0.631386	0.00992886	-0.1072544
0.052359878	0.759514	0.010161	-0.11068
0.06981317	0.886379	0.01045406	-0.113846
0.087266463	1.011723	0.01082305	-0.116729
0.104719755	1.1343	0.0113994	-0.119232
0.122173048	1.25536	0.0119786	-0.121448
0.13962634	1.37379	0.0126691	-0.123281
0.157079633	1.48841	0.01353	-0.124605
0.174532925	1.59782	0.014604	-0.125264
0.191986218	1.70005	0.0159672	-0.125048
0.20943951	1.7919	0.0177673	-0.1237
0.226892803	1.86782	0.0203501	-0.120926
0.244346095	1.92687	0.0238496	-0.117251
0.261799388	1.90901	0.0323572	-0.109308
0.27925268	1.88548	0.042586	-0.105246
0.314159265	1.72106	0.0767154	-0.102916
0.34906585	1.54737	0.119141	-0.110171
0.41887902	1.37176	0.201888	-0.134308
0.488692191	1.33611	0.279811	-0.157774
0.558505361	1.24258	0.374038	-0.184317
0.630811858	1.16657069674391	0.468820635304915	-0.210018955662083
0.703118356	1.09731371195717	0.568144803367644	-0.235311669052852
0.775424853	1.02914150424009	0.669952728182786	-0.255079611780897
0.847731351	0.958503519120397	0.772136186954782	-0.274847554508941
0.920037849	0.883254632655972	0.872580432676418	-0.293455242783626
0.992344346	0.802250209510933	0.969208246034644	-0.3114522708197
1.064650844	0.715099133809257	1.06002319749904	-0.329247025776226
1.136957341	0.622001975784801	1.14315121697017	-0.346406065339886
1.209263839	0.523636542129223	1.2168796037278	-0.363565104903546
1.281570336	0.421070394973381	1.27969266288401	-0.379493573754319
1.353876834	0.315688989737005	1.33030322499733	-0.395165673706575
1.426183332	0.20913306731581	1.3676793914705	-0.40982875627195
1.498489829	0.103241809281416	1.39106594804109	-0.423062397539245
1.570796327	8.32667268468867E-17	1.4	-0.436296038806539
1.643102824	-0.072269266496991	1.39106594804109	-0.443015004293534
1.715409322	-0.146393147121067	1.3676793914705	-0.449733969780528
1.78771582	-0.220982292815904	1.33030322499733	-0.452979114787347
1.860022317	-0.294749276481367	1.27969266288401	-0.453772151219927
1.932328815	-0.366545579490456	1.2168796037278	-0.453869671494912
2.004635312	-0.435401383049361	1.14315121697017	-0.450628714213448
2.07694181	-0.50056939366648	1.06002319749904	-0.447387756931984
2.149248307	-0.561575146657653	0.969208246034644	-0.444066599549505
2.221554805	-0.61827824285918	0.872580432676418	-0.440719923953067
2.293861303	-0.670952463384278	0.772136186954782	-0.43951315453821
2.3661678	-0.720399052968062	0.669952728182786	-0.442372206868359
2.438474298	-0.768119598370022	0.568144803367643	-0.445231259198508
2.510780795	-0.816599487720736	0.468820635304915	-0.453353192753145
2.583087293	-0.869806	0.374038	-0.461864969361447
2.622980533	-0.807677	0.324408455459959	-0.463836688745674
2.662873773	-0.745548	0.277075274255984	-0.446737375539148
2.702767013	-0.683419	0.232337563711276	-0.429638062332622
2.742660253	-0.62129	0.190478069242184	-0.412538749126096
2.782553493	-0.559161	0.151761378409852	-0.39543943591957
2.822446733	-0.497032	0.116432240254971	-0.409822103454864
2.862339973	-0.434903	0.084714010604476	-0.434698764570763
2.902233213	-0.372774	0.056807233237926	-0.459575425686663
2.942126453	-0.310645	0.032888365937279	-0.484452086802563
2.982019693	-0.248516	0.025868253508747	-0.457142857142857
3.021912933	-0.186387	0.021333025784437	-0.342857142857143
3.061806173	-0.124258	0.018072525946644	-0.228571428571429
3.101699414	-0.062129	0.016107778493333	-0.114285714285714
3.14	0	0.015451456175253	0
];    

alpha_i   = data(:,1);
cl_i      = data(:,2);
cd_i      = data(:,3);
cm_i      = data(:,4);
cl        = @(alpha)interp1(alpha_i,cl_i,alpha);
cd        = @(alpha)interp1(alpha_i,cd_i,alpha);
cm        = @(alpha)interp1(alpha_i,cm_i,alpha);

cl_data   = [alpha_i,cl_i];
cd_data   = [alpha_i,cd_i];
cm_data   = [alpha_i,cm_i];

end

function [us,ls] = getFFAW3_270bgeom
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
data_ls = [
0	-0.00019
0.00089	-0.00845
0.00355	-0.01641
0.00749	-0.02407
0.01224	-0.03122
0.01762	-0.03781
0.0234	-0.04403
0.02952	-0.0499
0.03592	-0.05547
0.04253	-0.06076
0.04932	-0.06581
0.05615	-0.07063
0.06309	-0.07523
0.07018	-0.07962
0.0774	-0.08382
0.08474	-0.08782
0.09218	-0.09164
0.09973	-0.09527
0.10736	-0.09873
0.11507	-0.10201
0.12286	-0.10512
0.13073	-0.10805
0.13866	-0.11082
0.14664	-0.11341
0.15469	-0.11584
0.16279	-0.11811
0.17093	-0.12022
0.17911	-0.12218
0.18733	-0.12397
0.19559	-0.12562
0.20387	-0.12711
0.21219	-0.12846
0.22053	-0.12966
0.22889	-0.13073
0.23726	-0.13166
0.24566	-0.13245
0.25406	-0.13312
0.26248	-0.13365
0.2709	-0.13406
0.27933	-0.13435
0.28777	-0.13451
0.2962	-0.13455
0.30464	-0.13447
0.31308	-0.13428
0.32151	-0.13397
0.32994	-0.13354
0.33836	-0.13301
0.34678	-0.13236
0.35518	-0.13161
0.36358	-0.13075
0.37196	-0.12978
0.38033	-0.12871
0.38869	-0.12753
0.39703	-0.12626
0.40536	-0.12489
0.41366	-0.12341
0.42195	-0.12185
0.43023	-0.1202
0.43848	-0.11845
0.44671	-0.11662
0.45493	-0.1147
0.46312	-0.1127
0.47129	-0.11061
0.47944	-0.10845
0.48757	-0.10621
0.49567	-0.1039
0.50376	-0.10152
0.51182	-0.09907
0.51986	-0.09656
0.52788	-0.09399
0.53589	-0.09137
0.54387	-0.0887
0.55184	-0.08599
0.55979	-0.08323
0.56773	-0.08044
0.57566	-0.07761
0.58358	-0.07476
0.59149	-0.07188
0.59939	-0.06898
0.60729	-0.06607
0.61518	-0.06315
0.62308	-0.06024
0.63098	-0.05732
0.63888	-0.05441
0.64679	-0.05152
0.65471	-0.04864
0.66263	-0.04579
0.67057	-0.04297
0.67853	-0.04019
0.68649	-0.03745
0.69448	-0.03476
0.70248	-0.03213
0.7105	-0.02955
0.71854	-0.02704
0.7266	-0.02459
0.73468	-0.02222
0.74278	-0.01993
0.75091	-0.01771
0.75905	-0.01559
0.76722	-0.01356
0.77541	-0.01163
0.78362	-0.00982
0.79186	-0.00814
0.80012	-0.00656
0.80839	-0.00511
0.81669	-0.00377
0.82499	-0.00254
0.83332	-0.00143
0.84165	-0.00044
0.85	0.00045
0.85835	0.00121
0.86671	0.00185
0.87508	0.00237
0.88346	0.00275
0.89184	0.003
0.90022	0.0031
0.90859	0.00305
0.91697	0.00287
0.92533	0.00254
0.93369	0.00207
0.94203	0.00147
0.95037	0.00074
0.95868	-0.00012
0.96698	-0.00112
0.97526	-0.00224
0.98352	-0.00347
0.99177	-0.00479
1	-0.00613
];  

data_us = [...
1	0.00652
0.99185	0.00831
0.98371	0.0101
0.97556	0.01188
0.96742	0.01366
0.95928	0.01544
0.95114	0.01721
0.94301	0.01898
0.93488	0.02076
0.92675	0.02255
0.91863	0.02435
0.91052	0.02617
0.90241	0.02799
0.8943	0.02982
0.8862	0.03166
0.8781	0.0335
0.87001	0.03535
0.86192	0.03721
0.85384	0.03907
0.84576	0.04094
0.83768	0.04281
0.8296	0.04468
0.82153	0.04655
0.81346	0.04843
0.80539	0.05031
0.79732	0.05219
0.78926	0.05407
0.7812	0.05594
0.77314	0.05782
0.76508	0.05969
0.75702	0.06157
0.74897	0.06343
0.74091	0.0653
0.73285	0.06716
0.7248	0.06901
0.71675	0.07086
0.70869	0.0727
0.70064	0.07453
0.69258	0.07636
0.68452	0.07817
0.67647	0.07997
0.66841	0.08176
0.66035	0.08355
0.65229	0.08531
0.64422	0.08707
0.63616	0.08881
0.62809	0.09054
0.62002	0.09225
0.61195	0.09395
0.60387	0.09562
0.5958	0.09729
0.58772	0.09893
0.57963	0.10055
0.57154	0.10215
0.56345	0.10373
0.55536	0.10529
0.54726	0.10683
0.53916	0.10834
0.53105	0.10983
0.52294	0.11129
0.51482	0.11272
0.5067	0.11413
0.49858	0.11551
0.49045	0.11686
0.48231	0.11817
0.47417	0.11946
0.46603	0.1207
0.45787	0.12191
0.44972	0.12307
0.44155	0.1242
0.43338	0.12529
0.42521	0.12633
0.41702	0.12733
0.40884	0.12828
0.40064	0.12918
0.39244	0.13003
0.38424	0.13083
0.37602	0.13157
0.36781	0.13226
0.35958	0.13288
0.35135	0.13345
0.34312	0.13395
0.33488	0.13438
0.32664	0.13474
0.31839	0.13502
0.31014	0.13523
0.30188	0.13537
0.29363	0.13541
0.28537	0.13537
0.27711	0.13524
0.26886	0.13501
0.2606	0.13469
0.25235	0.13426
0.24411	0.13373
0.23587	0.13308
0.22763	0.13233
0.21941	0.13146
0.2112	0.13048
0.20301	0.12936
0.19483	0.12811
0.18668	0.12672
0.17855	0.12518
0.17045	0.1235
0.16238	0.12167
0.15434	0.11969
0.14635	0.11754
0.1384	0.11522
0.1305	0.11274
0.12265	0.11008
0.11487	0.10724
0.10716	0.10422
0.09952	0.10101
0.09197	0.09759
0.08451	0.09398
0.07715	0.09014
0.06991	0.08609
0.0628	0.0818
0.05584	0.07727
0.04905	0.07247
0.04245	0.06739
0.03607	0.06196
0.02994	0.05624
0.02413	0.05049
0.01869	0.04439
0.0137	0.03792
0.00923	0.03107
0.0054	0.02383
0.00249	0.01614
0.00064	0.00809
0	-0.00019
];


ndy_ls      = 0.25 - data_ls(:,1);
ndy_us      = 0.25 - data_us(:,1);
ndz_ls      = data_ls(:,2);
ndz_us      = data_us(:,2);

ls          = @(ndy)interp1(ndy_ls,ndz_ls,ndy);
us          = @(ndy)interp1(ndy_us,ndz_us,ndy);

end

