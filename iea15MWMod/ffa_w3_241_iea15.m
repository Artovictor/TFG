function airfoil = ffa_w3_241_iea15
%ffa_w3_241_iea15  Gets airfoil structure of FFA-W3-241 according to [1]
%
%   A = ffa_w3_241_iea15 gets the structure of the FFA-W3-241 airfoil 
%   using data presented at reference [1].
%
%   The Reynolds number of the aerodynamic coefficients is 1e7. 
%
%   The aerodynamic data of the airfoil FFA-W3-241 has been obtained from 
%   the IEA 10MW reference wind turbine as defined by [1]
%
%   The geometry of the airfoil FFA-W3-241 has been obtained from the IEA
%   10MW reference wind turbine as defined by [1]
% 
%   Example of usage
%   p = ffa_w3_241_iea15;
%   plotAirfoil(p,{'FFA-W3-241'});
%   plotAirfoil(p,{'FFA-W3-241'},'alphaSpan',linspace(-6,12,360)*pi/180);
%
%   See also airfoil2d, plotAirfoil, getKmaxAirfoil2d, isAirfoil
%
%   TODO LIST
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
%
%
[cl,cd,cm,...
 cl_data,cd_data,cm_data] = getffa_w3_241_iea15AeroData;
% a = ffa_w3_241_iea15;
% [AoAopt,clOpt,cdOpt,kMax]  = getKmaxAirfoil2d(a.cl,a.cd,5*pi/180);
% format long 
% AoAopt,clOpt,kMax
% plotAirfoil(a,{'FFA-W3-241'},'alphaSpan',linspace(-10,40,360)*pi/180);
% figure(1)
% plot(180/pi*AoAopt,clOpt,'r o');
% figure(2)
% plot(180/pi*AoAopt,cdOpt,'r o');
% figure(3)
% plot(180/pi*AoAopt,kMax,'r o');

% Get airfoil geometry function handles
[us,ls]       = getFFAW3_241geom;
 
% Get optimum values for aerodynamic maximum efficiency 
alphaOp = 0.139626340159546;
clOp    = 1.344960000997411;
kmax    = 1.166699919112168e+02;
cdOp    = clOp/kmax;

% Get AoA interval for linear lift coefficient. This parameter was obtained
% by visual inspection of the figure resulting from the following code 
% snippet 
% 
% d2r            = pi/180;
% alphaspan      = linspace(-60,60,101)'.*d2r;
% airfoil        = @ffa_w3_241_iea15;
% alpha_s        = NaN;
% dsa            = getStallAirfoil(alphaspan,airfoil,alpha_s);
% plotStallAirfoil(dsa,alphaspan)

alpha_linear   = [-10 4]*pi/180;

% Define output structure
airfoil = struct(...
          'class','airfoil',...
          'familyName',"FFA",...
          'id','ffa_w3_241_iea15',...
          'ac',[0,0],...
          'ndtmax',0.211,...
          'alpha_linear',alpha_linear,...
          'alphaOpt',alphaOp,...
          'clOpt',clOp,...
          'cdOpt',cdOp,...
          'kMax',kmax,...
          'cldata',cl_data,...
          'cddata',cd_data,...
          'cmdata',cm_data,...
          'cl',cl,...
          'cd',cd,...
          'cm',cm,...
          'us',us,...
          'ls',ls...
);


end

function [cl,cd,cm,cl_data,cd_data,cm_data] = getffa_w3_241_iea15AeroData
%
% The next below data come from appendix B page 105 of reference [1]
%
%% References 
%
%  [1] Bortolotti, P., Tarres, H. C., Dykes, K. L., Merz, K., 
%      Sethuraman, L., Verelst, D., & Zahle, F. (2019). IEA Wind TCP 
%      Task 37: Systems engineering in wind energy-WP2. 1 Reference wind 
%      turbines (No. NREL/TP-5000-73492). National Renewable Energy 
%      Laboratory (NREL), Golden, CO (United States).

data = [...
-3.14	0	0.011775447064106	0
-3.101699414	0.058178	0.012482412601984	0.091428571428571
-3.061806173	0.116356	0.014598782404677	0.182857142857143
-3.021912933	0.174534	0.018110960546734	0.274285714285714
-2.98202	0.232712	0.022996390887794	0.365714285714286
-2.94213	0.29089	0.029223696475521	0.395676345052095
-2.902233213	0.349067999999999	0.053819698310667	0.388758497135448
-2.862339973	0.407246	0.083793992316186	0.381840649218801
-2.82245	0.465424	0.117863077897973	0.374922801302153
-2.78255	0.523602	0.155811951037112	0.374084328559101
-2.74266	0.58178	0.197401148799891	0.391483981336835
-2.70277	0.639958	0.242368269760347	0.40888363411457
-2.662873773	0.698136	0.290429640014088	0.426283286892304
-2.622980533	0.756314	0.341282114188998	0.443682939670039
-2.583087293	0.814492	0.394605	0.445371627554373
-2.510780795	0.779246430272421	0.496451521281863	0.444364356649118
-2.438474298	0.74510715913704	0.603194575273757	0.443598399428748
-2.3661678	0.708813748122248	0.712627707180579	0.446090176954347
-2.293861303	0.66834581155254	0.822490260992812	0.448581954479946
-2.221554805	0.622526357588158	0.930514449038506	0.453698910304514
-2.149248307	0.570795168175503	1.03447256083937	0.460197538918014
-2.07694181	0.513069204022943	1.13222332641883	0.46632771941537
-2.004635312	0.449649386335185	1.22175646690846	0.471299920119128
-1.932328815	0.381152728071047	1.30123450318436	0.476272120822887
-1.860022317	0.308458494313564	1.36903095054631	0.477047079464972
-1.78771582	0.232662156308824	1.42376410293311	0.476947612677542
-1.715409322	0.155033707627512	1.46432570227221	0.474088700822494
-1.643102824	0.076978532562729	1.48990389536682	0.467320575121653
-1.570796327	6.93889390390723E-17	1.5	0.460552449420812
-1.498489829	-0.076978532562729	1.48990389536682	0.445094567066936
-1.426183332	-0.155033707627512	1.46432570227221	0.42963668471306
-1.353876834	-0.232662156308823	1.42376410293311	0.411254122032161
-1.281570336	-0.308458494313564	1.36903095054631	0.390807079120421
-1.209263839	-0.381152728071047	1.30123450318436	0.369877737247955
-1.136957341	-0.449649386335184	1.22175646690846	0.346633360364009
-1.064650844	-0.513069204022943	1.13222332641883	0.323388983480063
-0.992344346	-0.570795168175503	1.03447256083937	0.299835448372687
-0.920037849	-0.622526357588158	0.930514449038506	0.276183544739673
-0.847731351	-0.66834581155254	0.822490260992812	0.252799227911334
-0.775424853	-0.708813748122248	0.712627707180579	0.229923326011878
-0.703118356	-0.745107159137039	0.603194575273758	0.207047424112423
-0.630811858	-0.779246430272421	0.496451521281863	0.145606014204667
-0.558505361	-0.814492	0.394605	0.0813079
-0.488692191	-1.077809	0.222521	0.0459169
-0.41887902	-1.12692	0.151592	0.0190103
-0.34906585	-1.1448	0.0969875	0.00063155
-0.314159265	-1.12797	0.0774353	-0.00342245
-0.27925268	-1.09392	0.0612223	-0.0058652
-0.244346095	-1.05961	0.0466721	-0.00652125
-0.20943951	-1.031215	0.0330216	-0.0075541
-0.174532925	-0.937059	0.0202688	-0.0224323
-0.13962634	-0.673795	0.01167894	-0.055829
-0.104719755	-0.403909	0.00917822	-0.0715901
-0.06981317	-0.14226	0.00838762	-0.0812253
-0.034906585	0.1158039	0.00810497	-0.0889202
-0.017453293	0.243824	0.00808247	-0.0923527
0	0.371129	0.00812783	-0.0955637
0.017453293	0.497655	0.00824029	-0.0985678
0.034906585	0.623342	0.00841819	-0.1013918
0.052359878	0.747981	0.00867336	-0.1040302
0.06981317	0.871372	0.00900857	-0.106451
0.087266463	0.993202	0.00944734	-0.108633
0.104719755	1.11325	0.00997828	-0.110572
0.122173048	1.23037	0.01070204	-0.112141
0.13962634	1.34496	0.0115279	-0.113368
0.157079633	1.45407	0.0126944	-0.113958
0.174532925	1.55911	0.0139646	-0.114027
0.191986218	1.65779	0.015453	-0.113365
0.20943951	1.74834	0.0172426	-0.111865
0.226892803	1.82666	0.0196113	-0.109351
0.244346095	1.88831	0.0229324	-0.1060607
0.261799388	1.92579	0.0279527	-0.1023772
0.27925268	1.92722	0.0360913	-0.0988692
0.314159265	1.80055	0.0653426	-0.0949704
0.34906585	1.63088	0.1045871	-0.0999569
0.41887902	1.43345	0.191485	-0.125888
0.488692191	1.28805	0.286294	-0.154528
0.558505361	1.16356	0.394605	-0.183965
0.630811858	1.11320918610346	0.496451521281863	-0.210986913944
0.703118356	1.0644387987672	0.603194575273758	-0.237679155067078
0.775424853	1.01259106874607	0.712627707180579	-0.259920813107698
0.847731351	0.954779730789343	0.822490260992812	-0.282162471148318
0.920037849	0.889323367983083	0.930514449038506	-0.303229213692406
0.992344346	0.815421668822146	1.03447256083937	-0.323677579659371
1.064650844	0.732956005747061	1.13222332641883	-0.343804909373067
1.136957341	0.64235626619312	1.22175646690846	-0.362923268005061
1.209263839	0.544503897244353	1.30123450318436	-0.382041626637055
1.281570336	0.44065499187652	1.36903095054631	-0.399438910020787
1.353876834	0.332374509012605	1.42376410293311	-0.416477636061131
1.426183332	0.221476725182159	1.46432570227221	-0.432309270999529
1.498489829	0.10996933223247	1.48990389536682	-0.446430860210171
1.570796327	9.71445146547012E-17	1.5	-0.460552449420812
1.643102824	-0.076978532562729	1.48990389536682	-0.467320575121653
1.715409322	-0.155033707627512	1.46432570227221	-0.474088700822494
1.78771582	-0.232662156308823	1.42376410293311	-0.476947612677542
1.860022317	-0.308458494313564	1.36903095054631	-0.477047079464972
1.932328815	-0.381152728071047	1.30123450318436	-0.476272120822887
2.004635312	-0.449649386335184	1.22175646690846	-0.471299920119128
2.07694181	-0.513069204022943	1.13222332641883	-0.46632771941537
2.149248307	-0.570795168175502	1.03447256083937	-0.460197538918014
2.221554805	-0.622526357588158	0.930514449038506	-0.453698910304514
2.293861303	-0.66834581155254	0.822490260992812	-0.448581954479946
2.3661678	-0.708813748122248	0.712627707180579	-0.446090176954347
2.438474298	-0.74510715913704	0.603194575273757	-0.443598399428748
2.510780795	-0.779246430272421	0.496451521281863	-0.444364356649118
2.583087293	-0.814492	0.394605	-0.445371627554373
2.622980533	-0.756314	0.341282114188998	-0.443682939670039
2.662873773	-0.698136	0.290429640014088	-0.426283286892304
2.702767013	-0.639958	0.242368269760347	-0.40888363411457
2.742660253	-0.58178	0.197401148799891	-0.391483981336835
2.782553493	-0.523602	0.155811951037112	-0.374084328559101
2.822446733	-0.465424	0.117863077897974	-0.39206565844501
2.862339973	-0.407246	0.083793992316186	-0.421840649218801
2.902233213	-0.349068	0.053819698310667	-0.451615639992591
2.942126453	-0.29089	0.029223696475521	-0.481390630766381
2.982019693	-0.232712	0.022996390887794	-0.457142857142857
3.021912933	-0.174534	0.018110960546734	-0.342857142857143
3.061806173	-0.116356	0.014598782404677	-0.228571428571429
3.101699414	-0.058178	0.012482412601984	-0.114285714285714
3.14	0	0.011775447064106	0
];    

alpha_i   = data(:,1);
cl_i      = data(:,2);
cd_i      = data(:,3);
cm_i      = data(:,4);
cl        = @(alpha)interp1(alpha_i,cl_i,alpha);
cd        = @(alpha)interp1(alpha_i,cd_i,alpha);
cm        = @(alpha)interp1(alpha_i,cm_i,alpha);

cl_data   = [alpha_i,cl_i];
cd_data   = [alpha_i,cd_i];
cm_data   = [alpha_i,cm_i];

end

function [us,ls] = getFFAW3_241geom
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
data_ls = [
0	0
7.807E-05	-0.00049018
0.00029009	-0.00184125
0.00059937	-0.00381822
0.00096448	-0.00605713
0.00146264	-0.00870563
0.00219661	-0.01122916
0.00309879	-0.01342212
0.00409516	-0.01534366
0.00526774	-0.01716693
0.00665839	-0.01909642
0.00821941	-0.02130654
0.00993095	-0.02351414
0.01187982	-0.02579914
0.01404463	-0.02815987
0.01639219	-0.03053974
0.01898469	-0.03296857
0.02182867	-0.03549058
0.02489252	-0.0380747
0.02822001	-0.04072568
0.03182924	-0.04345995
0.03568998	-0.04623151
0.03984236	-0.04907034
0.04430035	-0.05196961
0.04903788	-0.05490886
0.05410025	-0.05790431
0.05948747	-0.06095001
0.06518787	-0.06402491
0.07124791	-0.06712837
0.07764648	-0.07024411
0.08439704	-0.07337047
0.0915234	-0.07649115
0.09900711	-0.07959568
0.10688721	-0.08268285
0.11514762	-0.08571902
0.12380644	-0.08870503
0.13287211	-0.09161742
0.14233176	-0.09443777
0.1522146	-0.09716583
0.16249918	-0.09976981
0.17321393	-0.10223862
0.18434125	-0.10454454
0.19590296	-0.10668939
0.20788328	-0.10863043
0.22029378	-0.11037325
0.23312344	-0.11187776
0.24637487	-0.11314131
0.26004146	-0.11414886
0.27412439	-0.11486604
0.28861129	-0.11529721
0.30349962	-0.11537968
0.3187741	-0.11513331
0.33443448	-0.11450572
0.35045732	-0.11349774
0.36684322	-0.11208121
0.38356093	-0.11023393
0.40060975	-0.10793345
0.41795607	-0.10519348
0.4355933	-0.10197553
0.4534925	-0.0982976
0.47163211	-0.09414081
0.48999236	-0.08952202
0.50853595	-0.08447312
0.52724867	-0.07905685
0.5460886	-0.07331017
0.5650309	-0.0672996
0.58404504	-0.06109331
0.603088	-0.05477058
0.62213765	-0.04842523
0.64114752	-0.04213791
0.66008031	-0.03600811
0.67890619	-0.03012656
0.69757164	-0.02457508
0.71604492	-0.01942136
0.73429135	-0.01470107
0.75225234	-0.01045419
0.76989792	-0.00673447
0.78719153	-0.00355842
0.80407383	-0.00093374
0.82051349	0.00117919
0.83646946	0.00284598
0.85189026	0.00409407
0.86674791	0.00495249
0.8810097	0.00546535
0.89461041	0.00561958
0.90752456	0.00547727
0.9197304	0.00504714
0.9311753	0.00440395
0.94182765	0.00360867
0.95167536	0.00270812
0.96067486	0.0018027
0.96878747	0.00091285
0.97601191	5.718E-05
0.98233053	-0.00074311
0.98768615	-0.00146131
0.99208631	-0.00207989
0.99557391	-0.00258907
0.99806302	-0.00296293
0.99942968	-0.00317197
1	-0.00326
];  

data_us = [...
1	0.00425
0.99944304	0.0043621
0.99812049	0.00462832
0.99569352	0.00511699
0.99230484	0.00579959
0.98802844	0.00666146
0.98281508	0.00771282
0.97666422	0.0089541
0.96964069	0.01037253
0.96174313	0.01196864
0.95297315	0.01374233
0.94338928	0.01568187
0.93301284	0.01778563
0.92185147	0.02006929
0.90995468	0.0225171
0.89736121	0.02513781
0.88408503	0.02790923
0.8701629	0.03084911
0.85565276	0.03393611
0.84057695	0.03716418
0.82497463	0.04052857
0.80889455	0.04400982
0.79236237	0.04761716
0.77542101	0.05132667
0.75812546	0.05512297
0.7405018	0.05899393
0.72259209	0.06293412
0.70444539	0.06690084
0.68608843	0.07088321
0.66757021	0.07486708
0.64892678	0.07883497
0.63018643	0.08275436
0.61140138	0.08661408
0.59259673	0.09037299
0.57380843	0.09402539
0.5550757	0.09754917
0.53641763	0.10092636
0.51787958	0.10414685
0.49948103	0.10719326
0.48125155	0.11006231
0.46322225	0.1127122
0.44540666	0.11514729
0.42784323	0.11735341
0.41053864	0.11931701
0.39352525	0.12102638
0.37681123	0.12248809
0.36041977	0.12367942
0.34436494	0.12460233
0.32865846	0.12523852
0.31331898	0.12560509
0.29834798	0.1256738
0.2837658	0.12546547
0.26956679	0.12498975
0.25577362	0.12423636
0.2423778	0.12323884
0.22939648	0.12200236
0.21681735	0.12053786
0.20465763	0.11886654
0.19290757	0.11699332
0.18157496	0.11492977
0.17065819	0.11269298
0.16014896	0.110298
0.15005511	0.10776785
0.14035465	0.10510781
0.1310675	0.10233142
0.12216148	0.09945032
0.11365876	0.09649044
0.10553619	0.09345853
0.09779065	0.09036359
0.09042902	0.08722175
0.08341621	0.0840345
0.07677403	0.08082678
0.0704692	0.07759443
0.06450016	0.07434789
0.05888182	0.07110954
0.05356799	0.06787343
0.04857581	0.06465344
0.04389793	0.06145399
0.03949498	0.05826012
0.03539484	0.0551095
0.03157626	0.05199557
0.02800644	0.04891845
0.02471592	0.04589051
0.02168071	0.04289625
0.01886319	0.03991914
0.01629514	0.03700233
0.0139662	0.03418463
0.01181764	0.03137187
0.00988361	0.0286109
0.00818368	0.02603794
0.00663128	0.02342947
0.00524853	0.02076107
0.00408271	0.01830451
0.00308998	0.015951
0.00219098	0.01327076
0.00145967	0.0104986
0.00096333	0.00746215
0.00059878	0.00453721
0.00028988	0.00204453
7.804E-05	0.00050657
0           0
];


ndy_ls      = 0.25 - data_ls(:,1);
ndy_us      = 0.25 - data_us(:,1);
ndz_ls      = data_ls(:,2);
ndz_us      = data_us(:,2);

ls          = @(ndy)interp1(ndy_ls,ndz_ls,ndy);
us          = @(ndy)interp1(ndy_us,ndz_us,ndy);

end

