function airfoil = ffa_w3_360_iea15
%ffa_w3_360_iea15  Gets airfoil structure of FFA-W3-360 according to [1]
%
%   A = ffa_w3_360_iea15 gets the structure of the FFA-W3-360 airfoil 
%   using data presented at reference [1].
%
%   The Reynolds number of the aerodynamic coefficients is 1e7. 
%
%   The aerodynamic data of the airfoil FFA-W3-360 has been obtained from 
%   the IEA 10MW reference wind turbine as defined by [1]
%
%   The geometry of the airfoil FFA-W3-360 has been obtained from the IEA
%   10MW reference wind turbine as defined by [1]
% 
%   Example of usage
%   p = ffa_w3_360_iea15;
%   plotAirfoil(p,{'FFA-W3-360'});
%   plotAirfoil(p,{'FFA-W3-360'},'alphaSpan',linspace(-6,12,360)*pi/180);
%
%   See also airfoil2d, plotAirfoil, getKmaxAirfoil2d, isAirfoil
%
%   TODO LIST
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
%
%
[cl,cd,cm,...
 cl_data,cd_data,cm_data] = getffa_w3_360_iea15AeroData;
% a = ffa_w3_360_iea15;
% [AoAopt,clOpt,cdOpt,kMax]  = getKmaxAirfoil2d(a.cl,a.cd,5*pi/180);
% format long 
% AoAopt,clOpt,kMax
% plotAirfoil(a,{'FFA-W3-301'},'alphaSpan',linspace(-10,40,360)*pi/180);
% figure(1)
% plot(180/pi*AoAopt,clOpt,'r o');
% figure(2)
% plot(180/pi*AoAopt,cdOpt,'r o');
% figure(3)
% plot(180/pi*AoAopt,kMax,'r o');

% Get airfoil geometry function handles
[us,ls]       = getFFAW3_360geom;
 
% Get optimum values for aerodynamic maximum efficiency 
alphaOp = 0.139626340159546;
clOp    = 1.530900001003262;
kmax    = 83.611875736955469;
cdOp    = clOp/kmax;

% Get AoA interval for linear lift coefficient. This parameter was obtained
% by visual inspection of the figure resulting from the following code 
% snippet 
% 
% d2r            = pi/180;
% alphaspan      = linspace(-60,60,101)'.*d2r;
% airfoil        = @ffa_w3_360_iea15;
% alpha_s        = NaN;
% dsa            = getStallAirfoil(alphaspan,airfoil,alpha_s);
% plotStallAirfoil(dsa,alphaspan)

alpha_linear   = [-10 4]*pi/180;

% Define output structure
airfoil = struct(...
          'class','airfoil',...
          'familyName',"FFA",...
          'id','ffa_w3_360_iea15',...
          'ac',[0,0],...
          'ndtmax',0.360,...
          'alpha_linear',alpha_linear,...
          'alphaOpt',alphaOp,...
          'clOpt',clOp,...
          'cdOpt',cdOp,...
          'kMax',kmax,...
          'cldata',cl_data,...
          'cddata',cd_data,...
          'cmdata',cm_data,...
          'cl',cl,...
          'cd',cd,...
          'cm',cm,...
          'us',us,...
          'ls',ls...
);


end

function [cl,cd,cm,cl_data,cd_data,cm_data] = getffa_w3_360_iea15AeroData
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%

data = [...
-3.14	0	0.037147669556479	0
-3.101699414	0.0717815	0.037739011333743	0.091428571428571
-3.061806173	0.143563	0.039509147018855	0.182857142857143
-3.021912933	0.2153445	0.042446395533196	0.274285714285714
-2.98202	0.287126	0.046531377912444	0.365714285714286
-2.94213	0.3589075	0.051737137986679	0.403130463609555
-2.902233213	0.430689	0.060677994980879	0.408139205384842
-2.862339973	0.5024705	0.086507956646306	0.413147947160129
-2.82245	0.574252	0.115864640657473	0.418156688935416
-2.78255	0.6460335	0.148561980484281	0.426271290059555
-2.74266	0.717815	0.184392746602477	0.44370346923025
-2.70277	0.7895965	0.223129863707823	0.461135648400946
-2.662873773	0.861378	0.264527854054888	0.478567827571641
-2.622980533	0.9331595	0.308324397739495	0.496000006742337
-2.583087293	1.004941	0.354242	0.488302231833065
-2.510780795	0.918983244127881	0.441923929659964	0.467843151700018
-2.438474298	0.844062478771253	0.533788555334257	0.44803229885032
-2.3661678	0.774831575771483	0.627926992275896	0.436972514325827
-2.293861303	0.707903444174291	0.72238368231252	0.425912729801335
-2.221554805	0.64115839150801	0.815197168242102	0.421499653933276
-2.149248307	0.573351432804734	0.904440987486489	0.420584845779129
-2.07694181	0.503875114806371	0.988263831572409	0.42023862829755
-2.004635312	0.432607030599928	1.06492813335533	0.421679410072614
-1.932328815	0.359805246425593	1.13284627674209	0.423120191847678
-1.860022317	0.286031667542631	1.19061367331761	0.422581901514573
-1.78771582	0.212092141426912	1.23703801570306	0.421631304492265
-1.715409322	0.138986907503273	1.27116409730097	0.418644249677385
-1.643102824	0.06786776586895	1.29229368065155	0.412772212989694
-1.570796327	5.55111512312578E-17	1.3	0.406900176302003
-1.498489829	-0.067867765868949	1.29229368065155	0.394261488876898
-1.426183332	-0.138986907503273	1.27116409730097	0.381622801451794
-1.353876834	-0.212092141426912	1.23703801570306	0.366760595354425
-1.281570336	-0.286031667542631	1.19061367331761	0.350328846664867
-1.209263839	-0.359805246425593	1.13284627674209	0.333623748002802
-1.136957341	-0.432607030599928	1.06492813335533	0.315606569472701
-1.064650844	-0.503875114806371	0.988263831572409	0.2975893909426
-0.992344346	-0.573351432804734	0.90444098748649	0.27989180705497
-0.920037849	-0.64115839150801	0.815197168242102	0.262295912371764
-0.847731351	-0.70790344417429	0.72238368231252	0.244914943531712
-0.775424853	-0.774831575771483	0.627926992275896	0.227942333793656
-0.703118356	-0.844062478771253	0.533788555334258	0.2109697240556
-0.630811858	-0.918983244127882	0.441923929659964	0.135247812109577
-0.558505361	-1.004941	0.354242	0.0551741
-0.488692191	-1.113059	0.204936	0.0321142
-0.41887902	-1.054248	0.154343	0.0126789
-0.34906585	-0.982473	0.1096723	-0.00282125
-0.314159265	-0.941726	0.0924886	-0.0074129
-0.27925268	-0.893331	0.0759742	-0.0110695
-0.244346095	-0.854715	0.0605412	-0.01250065
-0.20943951	-0.82348	0.0464115	-0.01177275
-0.174532925	-0.795409	0.0344101	-0.01082065
-0.13962634	-0.636498	0.0254821	-0.0276937
-0.104719755	-0.390949	0.0199403	-0.0510679
-0.06981317	-0.1307082	0.0165337	-0.0714813
-0.034906585	0.1617258	0.0150697	-0.0917883
-0.017453293	0.311214	0.0147703	-0.1011907
0	0.459562	0.0146486	-0.1098835
0.017453293	0.605659	0.0146633	-0.1177635
0.034906585	0.748677	0.0148131	-0.124769
0.052359878	0.888617	0.0150716	-0.130977
0.06981317	1.025442	0.0154399	-0.136484
0.087266463	1.15878	0.0159264	-0.141299
0.104719755	1.28822	0.0165411	-0.1454
0.122173048	1.41282	0.0173108	-0.14875
0.13962634	1.5309	0.0183096	-0.151175
0.157079633	1.64065	0.0196309	-0.15262
0.174532925	1.73926	0.0214988	-0.153103
0.191986218	1.81971	0.0244544	-0.152545
0.20943951	1.87065	0.0296621	-0.151206
0.226892803	1.89221	0.0376996	-0.149693
0.244346095	1.8791	0.0482436	-0.145621
0.261799388	1.88111	0.0583757	-0.143578
0.27925268	1.86359	0.0699237	-0.140948
0.314159265	1.73324	0.1016591	-0.137106
0.34906585	1.59357	0.139159	-0.140821
0.41887902	1.46708	0.210024	-0.156927
0.488692191	1.44834	0.282003	-0.179786
0.558505361	1.43563	0.354242	-0.201472
0.630811858	1.31283320589697	0.441923929659964	-0.22408660971369
0.703118356	1.20580354110179	0.533788555334258	-0.246186068439215
0.775424853	1.10690225110212	0.627926992275896	-0.261330988824506
0.847731351	1.0112906345347	0.72238368231252	-0.276475909209798
0.920037849	0.915940559297157	0.815197168242102	-0.290620636827641
0.992344346	0.819073475435335	0.90444098748649	-0.304238947199459
1.064650844	0.71982159258053	0.988263831572409	-0.317870410877756
1.136957341	0.618010043714182	1.06492813335533	-0.331543213519272
1.209263839	0.514007494893704	1.13284627674209	-0.345216016160789
1.281570336	0.408616667918044	1.19061367331761	-0.358457212750131
1.353876834	0.302988773467017	1.23703801570306	-0.371608491411937
1.426183332	0.198552725004676	1.27116409730097	-0.384046258457397
1.498489829	0.096953951241356	1.29229368065155	-0.3954732173797
1.570796327	8.32667268468867E-17	1.3	-0.406900176302003
1.643102824	-0.067867765868949	1.29229368065155	-0.412772212989694
1.715409322	-0.138986907503273	1.27116409730097	-0.418644249677385
1.78771582	-0.212092141426912	1.23703801570306	-0.421631304492265
1.860022317	-0.286031667542631	1.19061367331761	-0.422581901514573
1.932328815	-0.359805246425593	1.13284627674209	-0.423120191847678
2.004635312	-0.432607030599928	1.06492813335533	-0.421679410072614
2.07694181	-0.503875114806371	0.988263831572409	-0.42023862829755
2.149248307	-0.573351432804734	0.90444098748649	-0.420584845779129
2.221554805	-0.64115839150801	0.815197168242102	-0.421499653933276
2.293861303	-0.707903444174291	0.72238368231252	-0.425912729801335
2.3661678	-0.774831575771483	0.627926992275896	-0.436972514325827
2.438474298	-0.844062478771253	0.533788555334257	-0.44803229885032
2.510780795	-0.918983244127881	0.441923929659964	-0.467843151700018
2.583087293	-1.004941	0.354242	-0.488302231833065
2.622980533	-0.9331595	0.308324397739495	-0.496000006742337
2.662873773	-0.861378	0.264527854054888	-0.478567827571641
2.702767013	-0.7895965	0.223129863707823	-0.461135648400946
2.742660253	-0.717815	0.184392746602477	-0.44370346923025
2.782553493	-0.6460335	0.148561980484281	-0.426271290059555
2.822446733	-0.574252	0.115864640657474	-0.435299546078273
2.862339973	-0.5024705	0.086507956646306	-0.453147947160129
2.902233213	-0.430689	0.060677994980879	-0.470996348241984
2.942126453	-0.3589075	0.051737137986679	-0.48884474932384
2.982019693	-0.287126	0.046531377912444	-0.457142857142857
3.021912933	-0.2153445	0.042446395533196	-0.342857142857143
3.061806173	-0.143563	0.039509147018855	-0.228571428571429
3.101699414	-0.0717815	0.037739011333743	-0.114285714285714
3.14	0	0.037147669556479	0
];    

alpha_i   = data(:,1);
cl_i      = data(:,2);
cd_i      = data(:,3);
cm_i      = data(:,4);
cl        = @(alpha)interp1(alpha_i,cl_i,alpha);
cd        = @(alpha)interp1(alpha_i,cd_i,alpha);
cm        = @(alpha)interp1(alpha_i,cm_i,alpha);

cl_data   = [alpha_i,cl_i];
cd_data   = [alpha_i,cd_i];
cm_data   = [alpha_i,cm_i];

end

function [us,ls] = getFFAW3_360geom
%
% The next below data come from reference [1]
%
%% References 
%
%  [1] IEA-15-240-RWT_tabular.xlsx excel file. 
%      From https://github.com/IEAWindTask37/IEA-15-240-RWT/tree/master/Documentation
%      Last accessed February 2024
%
data_ls = [
0	0
7.807E-05	-0.00122141
0.00029009	-0.00493025
0.00059937	-0.01006582
0.00096448	-0.01404194
0.00146264	-0.01818461
0.00219661	-0.02325986
0.00309879	-0.02895118
0.00409516	-0.03402694
0.00526774	-0.0386738
0.00665839	-0.04323037
0.00821941	-0.04768713
0.00993095	-0.05194808
0.01187982	-0.05640002
0.01404463	-0.06095587
0.01639219	-0.06550064
0.01898469	-0.07015335
0.02182867	-0.07483557
0.02489252	-0.07944017
0.02822001	-0.08403249
0.03182924	-0.08861876
0.03568998	-0.0931531
0.03984236	-0.09767683
0.04430035	-0.10219736
0.04903788	-0.1066798
0.05410025	-0.1111375
0.05948747	-0.11555036
0.06518787	-0.11988963
0.07124791	-0.12416757
0.07764648	-0.12835267
0.08439704	-0.13244594
0.0915234	-0.13644393
0.09900711	-0.14032619
0.10688721	-0.14410659
0.11514762	-0.14776228
0.12380644	-0.15130027
0.13287211	-0.15469824
0.14233176	-0.15792918
0.1522146	-0.16099444
0.16249918	-0.1638649
0.17321393	-0.16652604
0.18434125	-0.16898536
0.19590296	-0.1712123
0.20788328	-0.17318495
0.22029378	-0.17488931
0.23312344	-0.17629521
0.24637487	-0.1773821
0.26004146	-0.17812893
0.27412439	-0.17850404
0.28861129	-0.17851925
0.30349962	-0.17811179
0.3187741	-0.17729404
0.33443448	-0.17604386
0.35045732	-0.17433908
0.36684322	-0.17216093
0.38356093	-0.1694972
0.40060975	-0.1663269
0.41795607	-0.16263694
0.4355933	-0.15840197
0.4534925	-0.15361785
0.47163211	-0.14832974
0.48999236	-0.14256755
0.50853595	-0.13636209
0.52724867	-0.12973893
0.5460886	-0.12273428
0.5650309	-0.11537409
0.58404504	-0.10772338
0.603088	-0.09984354
0.62213765	-0.09178588
0.64114752	-0.08364761
0.66008031	-0.07551824
0.67890619	-0.06749519
0.69757164	-0.05967989
0.71604492	-0.05219166
0.73429135	-0.04509834
0.75225234	-0.03849862
0.76989792	-0.03246027
0.78719153	-0.02700348
0.80407383	-0.02213341
0.82051349	-0.01786296
0.83646946	-0.01419831
0.85189026	-0.0111631
0.86674791	-0.00876892
0.8810097	-0.00697163
0.89461041	-0.00574853
0.90752456	-0.0050322
0.9197304	-0.00479161
0.9311753	-0.004
0.94182765	-0.0037
0.95167536	-0.0034
0.96067486	-0.0031
0.96878747	-0.0028
0.97601191	-0.0025
0.98233053	-0.0022
0.98768615	-0.0019
0.99208631	-0.0016
0.99557391	-0.0013
0.99806302	-0.001
0.99942968	-0.001
1	-0.001
];  

data_us = [...
1	0.01298
0.99944304	0.01325853
0.99812049	0.01353706
0.99569352	0.01425486
0.99230484	0.01525428
0.98802844	0.01651103
0.98281508	0.01803672
0.97666422	0.01982832
0.96964069	0.02186386
0.96174313	0.02414104
0.95297315	0.02665721
0.94338928	0.02939433
0.93301284	0.03232052
0.92185147	0.03546139
0.90995468	0.03882788
0.89736121	0.04241907
0.88408503	0.04621907
0.8701629	0.0502115
0.85565276	0.05437484
0.84057695	0.05871183
0.82497463	0.06320372
0.80889455	0.06783179
0.79236237	0.07258367
0.77542101	0.0774446
0.75812546	0.08239019
0.7405018	0.0874051
0.72259209	0.09248713
0.70444539	0.09759082
0.68608843	0.10272181
0.66757021	0.10784802
0.64892678	0.11295158
0.63018643	0.11803077
0.61140138	0.12305212
0.59259673	0.12798755
0.57380843	0.13283094
0.5550757	0.13755364
0.53641763	0.14213236
0.51787958	0.14655625
0.49948103	0.15079572
0.48125155	0.154834
0.46322225	0.15864807
0.44540666	0.16221448
0.42784323	0.16552639
0.41053864	0.16856113
0.39352525	0.17131655
0.37681123	0.17376419
0.36041977	0.17590809
0.34436494	0.17773697
0.32865846	0.17926124
0.31331898	0.1804571
0.29834798	0.18132691
0.2837658	0.18187835
0.26956679	0.18211123
0.25577362	0.18203856
0.2423778	0.1816423
0.22939648	0.18093968
0.21681735	0.17992886
0.20465763	0.17862311
0.19290757	0.17701528
0.18157496	0.17511379
0.17065819	0.17293277
0.16014896	0.17048889
0.15005511	0.16779353
0.14035465	0.16485463
0.1310675	0.16169458
0.12216148	0.15833173
0.11365876	0.15478881
0.10553619	0.15107876
0.09779065	0.14720829
0.09042902	0.1431886
0.08341621	0.13900782
0.07677403	0.13472385
0.0704692	0.13032428
0.06450016	0.12581676
0.05888182	0.12122098
0.05356799	0.1165324
0.04857581	0.11179119
0.04389793	0.1070022
0.03949498	0.10214717
0.03539484	0.09729272
0.03157626	0.09242295
0.02800644	0.08751215
0.02471592	0.082622
0.02168071	0.07774621
0.01886319	0.07282291
0.01629514	0.06792968
0.0139662	0.06314469
0.01181764	0.05839354
0.00988361	0.05371176
0.00818368	0.04930104
0.00663128	0.04462295
0.00524853	0.03955245
0.00408271	0.03423391
0.00308998	0.02812695
0.00219098	0.02159887
0.00145967	0.01655986
0.00096333	0.01252495
0.00059878	0.0086197
0.00028988	0.00433033
7.804E-05	0.00116483
0           0
];


ndy_ls      = 0.25 - data_ls(:,1);
ndy_us      = 0.25 - data_us(:,1);
ndz_ls      = data_ls(:,2);
ndz_us      = data_us(:,2);

ls          = @(ndy)interp1(ndy_ls,ndz_ls,ndy);
us          = @(ndy)interp1(ndy_us,ndz_us,ndy);

end

